<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyB8RPTDWCPMRLl-IirhunsbBvCw-PRytVs",
      authDomain: "depression-b81de.firebaseapp.com",
      projectId: "depression-b81de",
      storageBucket: "depression-b81de.appspot.com",
      messagingSenderId: "206001450588",
      appId: "1:206001450588:web:4259c6db7d8c40894fc099"
    };
  
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const chatBox = document.getElementById("chat-box");
    const msgInput = document.getElementById("userMessage");
    const messagesRef = collection(db, "chatMessages");
    const q = query(messagesRef, orderBy("timestamp"));
  
    onSnapshot(q, (snapshot) => {
      // Clear and rebuild chat from scratch
      chatBox.innerHTML = "";
      const messages = [];
      snapshot.forEach((doc) => {
        messages.push(doc.data());
      });
  
      messages.forEach((msg) => {
        const div = document.createElement("div");
        div.innerHTML = `<strong>${msg.sender}:</strong> ${msg.message}`;
        chatBox.appendChild(div);
      });
  
      // Auto-scroll
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  
    window.sendUserMessage = async function () {
      const text = msgInput.value.trim();
      if (!text) return;
      await addDoc(messagesRef, {
        message: text,
        sender: "User",
        timestamp: Date.now()
      });
      msgInput.value = "";
    };
  </script>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f0fff0;
      color: #333;
    }
    #chat-box {
      border: 1px solid #ccc;
      height: 400px;
      overflow-y: scroll;
      padding: 10px;
      margin-bottom: 10px;
      background: white;
    }
    textarea {
      width: 100%;
      height: 60px;
      margin-bottom: 10px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <h1>Anonymous Chat Forum</h1>
  <div id="chat-box">Loading messages...</div>
  <textarea id="userMessage" placeholder="Type your message..."></textarea>
  <button onclick="sendUserMessage()">Send</button>
</body>
</html>
